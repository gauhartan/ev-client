<!DOCTYPE html>
<html lang="en">
<head>
    <title>Smart Charging</title>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" rel="stylesheet">
    <script crossorigin="anonymous"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="../static/style.css" rel="stylesheet" th:href="@{/style.css}"/>
</head>
<body>
<div class="container">
    <h1>Welcome to Smart Charging <i class="bi bi-lightning-charge-fill"></i></h1>
    <hr>
    <div class="wrap">
        <div class="resp-w45" id="d11">
            <a class="btn btn-primary btn-sm mb-3" th:href="@{/discharge/on}">Discharge (reset)
                <i class="bi bi-arrow-clockwise"></i></a>
            </button>
            <div id="dv-info" th:fragment="battery-info">
                <table>
                    <tr>
                        <td><i class="bi bi-watch"></i> Time:</td>
                        <td th:text="${#numbers.formatInteger(info.simTimeHour(), 2)} + ':' + ${#numbers.formatInteger(info.simTimeMin(),2)}"></td>
                    </tr>
                    <tr>
                        <td><i class="bi bi-plug"></i> Current energy <br/> consumption:</td>
                        <td th:text="${info.baseCurrentLoad()} + ' KWh'"></td>
                    </tr>
                    <tr>
                        <td><i class="bi bi-ev-front"></i> Batter SoC:</td>
                        <td th:text="${info.batteryCapacityKWh()} + ' KWh'"></td>
                    </tr>
                    <tr>
                        <td><i class="bi bi-ev-front"></i> Batter SoC level:</td>
                        <td>
                            <span th:text="${#numbers.formatDecimal(info.batteryCapacityKWh()/ 46.3 * 100, 1,2)} + '%'"></span>
                            <span>
<!--                            <div aria-label="Success example" aria-valuemax="100" aria-valuemin="0" aria-valuenow="25"-->
                                <!--                                 class="progress"-->
                                <!--                                 id="pbSocLevel" role="progressbar">-->
                                <!--                            <div class="progress-bar bg-success" id="pbSocLevel2" style="width: 25%">25%</div>-->
                                <!--                            </div>-->
                        </span>
                        </td>
                    </tr>
                    <tr>
                        <td><i class="bi bi-ev-station"></i> Charging status:</td>
                        <td>
                            <span>
                            <i th:class="${info.evBatteryChargeStartStop()? 'bi bi-battery-charging': 'bi bi-x-circle'}"></i></span>
                            <span th:class="${info.evBatteryChargeStartStop()? 'mb-2 bg-success': 'mb-2 bg-danger'}"
                                  th:text="${info.evBatteryChargeStartStop()? 'YES': 'NO'}"></span>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="resp-w45" id="d12">&nbsp;
        </div>
    </div>
    <hr/>
    <div>
        <div class="row g-4 py-5 row-cols-1 row-cols-lg-3">
            <div class="feature col">
                <div class="feature-icon d-inline-flex align-items-center justify-content-center text-bg-primary bg-gradient fs-2 mb-3">
                    <i class="bi bi-receipt-cutoff"></i>
                </div>
                <h3 class="fs-2 text-body-emphasis">Energy price (KWh) per hour</h3>
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Hour</th>
                        <th>Price (KWh/ore)</th>
                    </thead>
                    <tbody>
                    <tr th:each="rate, iter : ${rates.values()}">
                        <td th:text="${#numbers.formatInteger(iter.index, 2)}"></td>
                        <td th:text="${rate}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="feature col">
                <div class="feature-icon d-inline-flex align-items-center justify-content-center text-bg-primary bg-gradient fs-2 mb-3">
                    <i class="bi bi-cash-coin"></i>
                </div>
                <h3 class="fs-2 text-body-emphasis">Households Energy consumption per hour</h3>
                <div id="b1">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>Hour</th>
                            <th>KWh</th>
                        </thead>
                        <tbody>
                        <tr th:each="ec, iter : ${energyconsumption.values()}">
                            <td th:text="${#numbers.formatInteger(iter.index, 2)}"></td>
                            <td th:text="${ec}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="feature col">
                <div class="feature-icon d-inline-flex align-items-center justify-content-center text-bg-primary bg-gradient fs-2 mb-3">
                    <span><i class="bi bi-cash-coin"></i></span> &nbsp;&nbsp;&nbsp; <span><i
                        class="bi bi-receipt-cutoff"></i></span>
                </div>
                <h3 class="fs-2 text-body-emphasis">Recommended hours to charge the EV</h3>
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Hour</th>
                        <th>Price</th>
                    </thead>
                    <tbody>
                    <tr th:each="recommendation : ${recommendations}">
                        <td th:text="${#numbers.formatInteger(recommendation.hour(), 2)}"></td>
                        <td th:text="${recommendation.price()}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        var soccLevel = '${#numbers.formatDecimal(info.batteryCapacityKWh()/ 46.3 * 100, 1,2)}';
        $("#pbSocLevel")
            .attr("aria-valuenow", 93);
        $("#pbSocLevel2")
            .css("width", 93 + "%")
            .text(93 + "% Complete");

    });

    // const getData = () => {
    //
    //     var interval = setInterval(function () {
    //         fetch('battery/info').then(function (response) {
    //             return response.text();
    //         }).then(function (html) {
    //             document.getElementById("dv-info").innerHTML = html;
    //         }).catch(function (err) {
    //             console.warn('Something went wrong while fetching battery-info.', err);
    //         });
    //     }, 1000);
    // }

    $(document).ready(function () {

        var interval = setInterval(function () {
            fetch('battery/info').then(function (response) {
                return response.text();
            }).then(function (html) {
                document.getElementById("dv-info").innerHTML = html;
            }).catch(function (err) {
                console.warn('Something went wrong while fetching battery-info.', err);
            });
        }, 1000);
    });

</script>
</body>
</html>